<p><img src="images/tim50x50.png" align="left">Tutorial 1 showed you the useage of the QgsMapCanvas api to create a simple application that loads a shapefile and displays the points in it. But what good is map that you can't interact with? Enter our second tutorial where we show you how to use QgsMapTool - the base class for all tools that need to interact with the  canvas.</p>

<strong>Updated November 2008 to use cmake build system and the updated QGIS 1.0.0 API. Tim</strong>

<!--break-->
<p><img src="http://blog.qgis.org/files/mapcanvas_tut2.jpg"/></p>

<p>Today I will extend the last tutorial by making it a QMainWindow application with a menu, toolbar and canvas area. The purpose of the tutorial is to provide a demonstrator project, so I wont promise to write the most elegant or robust C++ code. The project will provide 4 toolbar icons for</p>

<ul>
<li>loading a map layer (layer name is hard coded in the application</li>
<li>zooming in</li>
<li> zooming out</li>
<li> panning</li>
</ul>
<p>The entire project can be checked out form the QGIS Subversion repository using the following command:</p>

<pre>svn co https://svn.osgeo.org/qgis/trunk/code_examples/2_basic_main_window</pre>


<p>In the working directory for the tutorial code you will find a number of files including c++ sources, icons and a simple data file under data. There is also the .ui file for the main window.</p>

<p><strong>Note:</strong> You will need to edit the .pro file in the above svn directory to match your system.

<p>Since much of the code is the same as the previous tutorial, I will focus on the MapTool specifics - the rest of the implementation details can be investigated by checking out the project form SVN. A QgsMapTool is a class that interacts with the MapCanvas using the mouse pointer. QGIS has a number of QgsMapTools implemented, and you can subclass QgsMapTool to create your own. In mainwindow.cpp you will see I include the headers for the QgsMapTools near the start of the file:</p>

<pre>
     30 //
     31 // QGIS Map tools
     32 //
     33 #include "qgsmaptoolpan.h"
     34 #include "qgsmaptoolzoom.h"
     35 //
     36 // These are the other headers for available map tools (not used in this example)
     37 //
     38 //#include "qgsmaptoolcapture.h"
     39 //#include "qgsmaptoolidentify.h"
     40 //#include "qgsmaptoolselect.h"
     41 //#include "qgsmaptoolvertexedit.h"
     42 //#include "qgsmeasure.h"
</pre>

<p>As you can see, I am only using two types of MapTool subclasses for this tutorial, but there are more available in the QGIS library. Hooking up our MapTools to the canvas is very easy using the normal Qt4 signal/slot mechanism:</p>

<pre>
     78   //create the action behaviours
     79   connect(mActionPan, SIGNAL(triggered()), this, SLOT(panMode()));
     80   connect(mActionZoomIn, SIGNAL(triggered()), this, SLOT(zoomInMode()));
     81   connect(mActionZoomOut, SIGNAL(triggered()), this, SLOT(zoomOutMode()));
     82   connect(mActionAddLayer, SIGNAL(triggered()), this, SLOT(addLayer()));
</pre>

<p>Next we make a small toolbar to hold our toolbuttons. Note that the mpAction* actions were created in designer.</p>

<pre>
     84   //create a little toolbar
     85   mpMapToolBar = addToolBar(tr("File"));
     86   mpMapToolBar-&gt;addAction(mpActionAddLayer);
     87   mpMapToolBar-&gt;addAction(mpActionZoomIn);
     88   mpMapToolBar-&gt;addAction(mpActionZoomOut);
     89   mpMapToolBar-&gt;addAction(mpActionPan);
</pre>

<p>Thats really pretty straightforward Qt stuff too. Now we create our three map tools:</p>

<pre>
     91   //create the maptools
     92   mpPanTool = new QgsMapToolPan(mpMapCanvas);
     93   mpPanTool-&gt;setAction(mpActionPan);
     94   mpZoomInTool = new QgsMapToolZoom(mpMapCanvas, FALSE); // false = in
     95   mpZoomInTool-&gt;setAction(mpActionZoomIn);
     96   mpZoomOutTool = new QgsMapToolZoom(mpMapCanvas, TRUE ); //true = out
     97   mpZoomOutTool-&gt;setAction(mpActionZoomOut);
</pre>

<p>Again nothing here is very complicated - we are creating tool instances, each of which is associated with the same mapcanvas, and a different QAction. When the user selects one of the toolbar icons, the active MapTool for the canvas is set. For example when the pan icon is clicked, we do this:</p>

<pre>
    110 void MainWindow::panMode()
    111 {
    112   mpMapCanvas-&gt;setMapTool(mpPanTool);
    113 
    114 }
</pre>


<p><strong>Conclusion</strong></p>

<p>As you can see extending our previous example into something more functional using MapTools is really easy and only requires a few lines of code for each MapTool you want to provide.</p>

You can check out and build this tutorial using SVN and CMake using the following steps:

<code>
svn co https://svn.osgeo.org/qgis/trunk/code_examples/2_basic_main_window
cd 2_basic_main_window
mkdir build
#optionally specify where your QGIS is installed (should work on all platforms)
#if your QGIS is installed to /usr or /usr/local you can leave this next step out
export LIB_DIR=/home/timlinux/apps
cmake ..
make
./timtut2
</code>

<!-- technorati tags begin --><p style="font-size:10px;text-align:right;">technorati tags:<a href="http://technorati.com/tag/QgsMapCanvas" rel="tag">QgsMapCanvas</a>, <a href="http://technorati.com/tag/MapTool" rel="tag">MapTool</a>, <a href="http://technorati.com/tag/c++" rel="tag">c++</a>, <a href="http://technorati.com/tag/subversion" rel="tag">subversion</a>, <a href="http://technorati.com/tag/tutorial" rel="tag">tutorial</a></p><!-- technorati tags end -->
